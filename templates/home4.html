<!DOCTYPE html>
<html>
   <head>
      <title>Byte Beat</title>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
         integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.0/css/all.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5/Qzj62A4s8ti6G2wn30S2l35F2y935J2F3fUjD/" crossorigin="anonymous" />
      <style>
         body {
         background-image: url('https://your-background-image-url.com');
         background-repeat: no-repeat;
         background-size: cover;
         font-family: Arial, sans-serif;
         }
         #banner {
         width: 25%;
         object-fit: contain;
         }
         .navbar {
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         background-color: white !important;
         }
         .nav-link {
         font-size: 1.25rem;
         color: #333333;
         background-color: white;
         padding: 10px 15px;
         border-radius: 5px;
         border: 1px solid transparent;
         transition: all 0.3s;
         }
         .nav-link:hover {
         color: white;
         background-color: #333333;
         border: 1px solid #333333;
         }
         .welcome {
         font-size: 2rem;
         color: #333333;
         }
         #datetime {
         font-size: 1.5rem;
         color: #333333;
         }
         .domain-box {
         width: 100%;
         display: flex;
         justify-content: flex-end;
         align-items: center;
         flex-wrap: nowrap;
         gap: 1rem;
         position: sticky;
         top: 0;
         background-color: white;
         padding: 1rem 0;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         z-index: 10;
         }
         .domain-button {
         cursor: pointer; /* Add this to show a hand with a finger(selector) when hovering over the buttons */
         font-size: 1.25rem;
         color: #333333;
         background-color: white;
         padding: 10px 15px;
         border-radius: 5px;
         border: 1px solid transparent;
         text-decoration: none;
         transition: all 0.3s;
         }
         .domain-button:hover {
         color: white;
         background-color: #333333;
         border: 1px solid #333333;
         }
         .current-domain {
         background-color: blue;
         color: white;
         }
         .card {
         box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
         transition: all 0.3s;
         }
         .card:hover {
         transform: translateY(-5px);
         box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
         }
         .card-url {
         background-color: #333333;
         color: white;
         border: none;
         padding: 10px 20px;
         border-radius: 5px;
         transition: all 0.3s;
         }
         .card-url:hover {
         background-color: #666666;
         }
         .save-article-button {
         background-color: #333333;
         color: white;
         border: none;
         padding: 10px 20px;
         border-radius: 5px;
         cursor: pointer;
         transition: all 0.3s;
         }
         .save-article-button:hover {
         background-color: #666666;
         }
         .articles-text {
         font-weight: bold;
         }
         .current-domain-text {
         font-weight: bold;
         margin-bottom: 10px;
         }
         .selected-domain {
         background-color: #333333;
         color: white;
         border: 1px solid #333333;
         }
         .domain-button:active {
         transform: translateY(2px);
         }
      </style>
   </head>
   <body>
      {% block content %}
      <div class="container">
         <img class="img-fluid align-top align-left" id="banner" src="http://127.0.0.1:5000/static/BB Logo.png" />
         <div class="centered-navbar">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
               <div class="container-fluid">
                  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                     aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon"></span>
                  </button>
                  <div class="collapse navbar-collapse" id="navbarNav">
                     <ul class="navbar-nav">
                        <li class="nav-item">
                           <a class="nav-link active" aria-current="page" href="http://127.0.0.1:5000/home">Home</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="http://127.0.0.1:5000/saved">Saved Articles</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" href="http://127.0.0.1:5000/options">Options</a>
                        </li>
                     </ul>
                  </div>
               </div>
            </nav>
         </div>
         <h2 class="text-left mt-2 mb-4 welcome">Welcome! <span class="articles-text">Articles</span></h2>
         <div id="datetime" class="text-muted mb-3"></div>
         <!-- Move the domain box code here -->
         <div class="row">
            <div class="col-md-6">
               <div id="datetime" class="text-muted mb-3"></div>
            </div>
            <div class="col-md-6">
               <div class="domain-box">
                  <div class="current-domain-text">Current Domain:</div>
                  <a class="domain-button" id="changeDomain1" onclick="changeDomain('techcrunch')">TechCrunch</a>
                  <a class="domain-button" id="changeDomain2" onclick="changeDomain('engadget')">Engadget</a>
                  <a class="domain-button" id="changeDomain3" onclick="changeDomain('gizmodo')">Gizmodo</a>
               </div>
            </div>
         </div>
         <div class="row">
            <!-- Add this new row for articles -->
            {% for article in articles %}
            <!-- Change the column size from col-md-4 to col-md-6 for 2 articles in a row -->
            <div class="col-md-6">
               <div class="card mb-4">
                  <img src="{{ article.urlToImage }}" class="card-img-top
                     " alt="img not found">
                  <div class="card-body">
                     <h5 class="card-title">{{ article.title }}</h5>
                     <p class="card-text">{{ article.description }}</p>
                     <a class="card-url" href="{{ article.url }}" class="btn btn-primary" target="_blank">Read more</a>
                     <!--The input button 'Save Article' will pass the id, title, and url to the saveArticle function.-->
                     <input type="button" onclick="saveArticle(this.id, '{{article.title}}', '{{article.url}}')"
                        id="card' + {{ article.index }} +'" value="Save Article" class="save-article-button" />
                     <script>
                        //articleId = "card' + {{ article.index }} +'"
                        //articleTitle = the complete, verbatim title from the article
                        //articleUrl - the complete, verbatim URL of the article link
                        function saveArticle(articleId, articleTitle, articleUrl) {
                        //only the title and url of the article will be saved
                        const articleToSave = {
                        title: articleTitle,
                        url: articleUrl
                        };
                        //the local storage item is called, then the new article is appended, finally the updated list is stored
                        const savedArticles = JSON.parse(localStorage.getItem('savedArticles')) || [];
                        savedArticles.push(articleToSave);
                        localStorage.setItem('savedArticles', JSON.stringify(savedArticles));
                        };
                     </script>
                  </div>
               </div>
            </div>
            {% endfor %}
         </div>
      </div>
      {% endblock %}
      </div>
      <script>
         // Get the current date and
         let today = new Date();
         // Format the date and time to display
         let date = today.toLocaleDateString();
         let time = today.toLocaleTimeString();
         
         // Display the date and time
         let datetime = document.getElementById('datetime');
         datetime.innerHTML = `${date} ${time}`;
         
      </script>
      <script>
         // Add this function to handle the domain change
         function changeDomain(newDomain) {
         const domainButtons = document.getElementsByClassName('domain-button');
         for (let button of domainButtons) {
             if (button.innerText.toLowerCase() === newDomain) {
                 button.classList.add('selected-domain');
             } else {
                 button.classList.remove('selected-domain');
             }
         }
         
         // Fetch new articles based on the selected domain
         fetch('/fetch_articles', {
             method: 'POST',
             headers: {
                 'Content-Type': 'application/x-www-form-urlencoded'
             },
             body: new URLSearchParams({ domain: newDomain })
         }).then(response => response.json()).then(articles => {
             updateArticles(articles);
         });
         }
         
         
         function updateArticles(articles) {
         const articleContainer = document.querySelector('.row');
         // Get the domain box element
         const domainBox = document.querySelector('.domain-box');
         // Remove all elements inside the row except for the domain box
         articleContainer.innerHTML = '';
         articleContainer.appendChild(domainBox);
         
         for (const article of articles) {
             const articleElement = document.createElement('div');
             articleElement.className = 'col-md-6';
             articleElement.innerHTML = `
                 <div class="card mb-4">
                     <img src="${article.urlToImage}" class="card-img-top" alt="img not found">
                     <div class="card-body">
                         <h5 class="card-title">${article.title}</h5>
                         <p class="card-text">${article.description}</p>
                         <a class="card-url" href="${article.url}" class="btn btn-primary" target="_blank">Read more</a>
                         <input type="button" onclick="saveArticle(this.id, '${article.title}', '${article.url}')" id="card${article.index}" value="Save Article" class="save-article-button" />
                     </div>
                 </div>`;
             articleContainer.appendChild(articleElement);
         }
         }
         
      </script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js"
         integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N"
         crossorigin="anonymous"></script>
   </body>
</html>